<template>
  <div class="main-container">
    <h2>Understanding Composed Property in LWC Custom Events</h2>
    
    <div class="section">
      <h3>What is the 'composed' property?</h3>
      <p>
        The <code>composed</code> property in custom events determines whether an event can
        cross the shadow DOM boundary. When <code>composed: true</code>, the event propagates
        through shadow DOM boundaries. When <code>composed: false</code>, it stops at the
        shadow DOM boundary.
      </p>
    </div>

    <div class="section">
      <h3>Live Example - Composed Event (crosses shadow DOM)</h3>
      <c-composed-event-child
        oncomposedcustomevent={handleComposedEvent}
      ></c-composed-event-child>
      <div class="event-info">
        <h4>Composed Event Listener Status:</h4>
        <p class="status-text" lwc:if={composedEventReceived}>
          ‚úì Event Received at Parent Level
        </p>
        <p class="status-text" lwc:elseif={composedEventAttempted}>
          ‚úó Listener is active and waiting for event...
        </p>
        <template lwc:if={composedEventDetail}>
          <div class="event-detail">
            <strong>Event Details:</strong>
            <p>Message: {composedEventDetail.message}</p>
            <p>Timestamp: {composedEventDetail.timestamp}</p>
          </div>
        </template>
      </div>
    </div>

    <div class="section">
      <h3>Live Example - Non-Composed Event (blocked at shadow DOM)</h3>
      
      <div style="background-color: #e3f2fd; padding: 10px; border-radius: 4px; border-left: 4px solid #2196F3; margin-bottom: 15px;">
        <strong>üìç How to Read This Example:</strong>
        <ul style="margin: 5px 0;">
          <li><strong>Shadow DOM Level 1 (this component):</strong> composedEventDemo (grandparent)</li>
          <li><strong>Shadow DOM Level 2:</strong> wrapperMiddle (parent/wrapper)</li>
          <li><strong>Shadow DOM Level 3:</strong> nonComposedEventChild (child)</li>
        </ul>
      </div>

      <c-wrapper-middle
        onnoncomposedcustomevent={handleNonComposedEventAtGrandparent}
      ></c-wrapper-middle>

      <div class="event-info" style="margin-top: 15px; background-color: #fff3e0; padding: 15px; border-left: 4px solid #ff9800;">
        <h4>üî¥ Grandparent (composedEventDemo) Listener Status:</h4>
        <p class="status-text" lwc:if={nonComposedEventReceivedAtGrandparent} style="background-color: #ffebee; color: #c62828; border: 1px solid #ef5350;">
          ‚ö†Ô∏è ERROR: Grandparent received non-composed event!
        </p>
        <p class="status-text" lwc:else style="background-color: #e8f5e9; color: #2e7d32; border: 1px solid #4caf50;">
          ‚úÖ CORRECT: Grandparent does NOT receive non-composed event (blocked by wrapper boundary)
        </p>
        
        <div style="margin-top: 15px; padding: 10px; background-color: #fce4ec; border-radius: 3px;">
          <p style="margin: 0;"><strong>üìä Event Flow with composed: false:</strong></p>
          <p style="margin: 5px 0; font-family: monospace; font-size: 12px;">
            <br/>
            ‚Üì<br/>
            ‚úì wrapper receives it (same shadow DOM level)<br/>
            ‚Üì<br/>
            ‚úó BLOCKED at wrapper's shadow DOM boundary<br/>
            ‚Üì<br/>
            ‚úó grandparent does NOT receive it
          </p>
        </div>

        <p class="info-message" style="margin-top: 10px; background-color: #f5f5f5; padding: 10px; border-radius: 3px;">
          üìã <strong>Check Console Output:</strong><br/>
          üü† [WRAPPER] RECEIVED non-composed event (expected - internal event)<br/>
          ‚ùå [GRANDPARENT ERROR] should NOT appear in console<br/>
          <br/>
          If "[GRANDPARENT ERROR]" appears, it means the event is crossing the shadow DOM boundary (incorrect behavior).
        </p>
      </div>
    </div>

    <div class="section key-differences">
      <h3>Key Differences</h3>
      <table>
        <thead>
          <tr>
            <th>Property</th>
            <th>Composed: true</th>
            <th>Composed: false</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Shadow DOM Boundary</strong></td>
            <td>Crosses (propagates)</td>
            <td>Stops (blocked)</td>
          </tr>
          <tr>
            <td><strong>Parent Listener</strong></td>
            <td>Can receive event</td>
            <td>Cannot receive event</td>
          </tr>
          <tr>
            <td><strong>Use Case</strong></td>
            <td>Public component events</td>
            <td>Internal component events</td>
          </tr>
          <tr>
            <td><strong>Example</strong></td>
            <td>click, change events</td>
            <td>Internal state changes</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="section">
      <h3>Console Output</h3>
      <p>Open the browser console (F12) to see detailed logs of both events.</p>
      <p><strong>Look for:</strong></p>
      <ul>
        <li>"Composed event dispatched:" - Shows composed event with composed: true</li>
        <li>"Non-composed event dispatched:" - Shows non-composed event with composed: false</li>
      </ul>
    </div>
  </div>
</template>
